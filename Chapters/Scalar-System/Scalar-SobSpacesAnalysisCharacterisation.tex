\subsection{Characterisation of Sobolev Spaces}
Corollary \ref{cory:3DTangGradRotated} provides us with an explicit expression for the tangential gradient of a function on one edge of $\graph$.
Given that proposition \ref{prop:3DGradZeroChar} informs us that the set of gradients of zero on $\graph$ can be formed from combining gradients of zero on each edge, we can now obtain an expression for $\ktgrad_{\ddmes}u$ on any edge $I_{jk}$.
However this is not all that we should expect from $u\in\ktgradSob{\ddom}{\ddmes}$-functions --- given that $u$ possesses a trace from each edge into the vertices, and is approximated on each edge by the \emph{same} sequence of smooth functions, we should these traces to match at vertices common to multiple edges.
This will carry over into the behaviour of $\ktgradSob{\ddom}{\dddmes}$-functions too, however the gradients of functions in $\ktgradSob{\ddom}{\massMes}$ are rather simple, owing to the fact that $\gradZero{\ddom}{\massMes}$ encompasses a large proportion of $\ltwo{\ddom}{\dddmes}^3$.
Indeed, we have the following result that follows immediately from proposition \ref{prop:NuGradZeroChar}.
\begin{cory}[Characterisation of $\ktgradSob{\ddom}{\massMes}$] \label{cory:NuTangGradChar}
	It holds that:
	\begin{enumerate}[(i)]
		\item If $u\in\ktgradSob{\ddom}{\massMes}$ then $\ktgrad_{\massMes}u = \bracs{0,0,\rmi\wavenumber u}^\top$.
		\item If $u\in\ltwo{\ddom}{\massMes}$, then $u\in\ktgradSob{\ddom}{\massMes}$.
	\end{enumerate}
\end{cory}
That is to say, every $\ltwo{\ddom}{\massMes}$ function possesses a tangential gradient, and that tangential gradient is simply the function $\bracs{0,0,\rmi\wavenumber u}^\top\in\ltwo{\ddom}{\massMes}^3$.
\begin{proof}
	\begin{enumerate}[(i)]
		\item Suppose that $u\in\ktgradSob{\ddom}{\massMes}$ with $\ktgrad_{\massMes}u = \bracs{v_1,v_2,v_3}^\top$.
		Since $\ktgrad_{\massMes}u\perp\gradZero{\ddom}{\massMes}$, and given proposition \ref{prop:NuGradZeroChar}, we must have that $v_1 = v_2 = 0$.
		Now let $\phi_n$ be an approximating sequence for $u$.
		Since $\phi_n\rightarrow u$, we must have that $\rmi\wavenumber\phi_n\rightarrow\rmi\wavenumber u$, which forces $v_3 = \rmi\wavenumber u$.
		\item If $u\in\ltwo{\ddom}{\massMes}$, for each $v_j\in\vertSet$ let $\psi_j$ denote the smooth ``bump" function centred on $v_j$ with
		\begin{align*}
			\psi_j\bracs{v_j} = 1, \quad \supp\bracs{\psi_j}\subset B_d\bracs{v_j},
		\end{align*}
		where $d$ is as in \eqref{eq:HalfMinDistBetweenVertsDef}.
		Setting $\phi\bracs{x} = \sum_{v_j\in\vertSet}u\bracs{v_j}\psi_j\bracs{x}$, we have that $\phi\in\psmooth{\ddom}$ and that $\phi = u$ in $\ltwo{\ddom}{\massMes}$.
		Therefore, $\bracs{u, \ktgrad\phi}\in W^{\kt}_{\massMes,\mathrm{grad}}$, and hence there exists some $\ktgrad_\massMes u\in\gradZero{\ddom}{\massMes}^\perp$ such that $u\in\ktgradSob{\ddom}{\massMes}$.
	\end{enumerate}
\end{proof}

Our next objective is to prove the following result:
\begin{theorem}[Characterisation of Tangential Gradients] \label{thm:CharOfSobSpaces}
	The following necessary and sufficient conditions hold.
	\begin{enumerate}[(i)]
		\item Let $u\in\pltwo{\ddom}{\ddmes}$.
		Then
		\begin{align}
			u\in\ktgradSob{\ddom}{\ddmes} 
			&\quad\Leftrightarrow\quad 
			\begin{cases} 
				\mathrm{(a)} \ u_{jk}\in\ktgradSob{\ddom}{\lambda_{jk}}, & \forall I_{jk}\in\edgeSet, \\
				\mathrm{(b)} \ u \text{ is continuous at } v_j, & \forall v_j\in\vertSet.
			\end{cases}
		\end{align}
		\item Suppose that $u\in\pltwo{\ddom}{\dddmes}$.
		Then
		\begin{align*}
			u\in\ktgradSob{\ddom}{\dddmes} 
			&\quad\Leftrightarrow\quad 
			u\in\ktgradSob{\ddom}{\ddmes}.	
		\end{align*}
	\end{enumerate}
\end{theorem}
That is to say, the tangential gradient $\ktgrad_{\dddmes}u$ inherits the behaviour of the tangential gradients of $u$ on the edges and at the vertices.
Due to the lengthy nature of some of the arguments involved, we will present the proof of theorem \ref{thm:CharOfSobSpaces} in a series of separate results.
The main complexity coming in the proof of theorem \ref{thm:CharOfSobSpaces}(i), for reasons we will elaborate on shortly.
We also highlight that a result analogous to theorem \ref{thm:CharOfSobSpaces} is claimed without proof in \cite{zhikov2002homogenization}, with the reader being redirected to another result in the same work for an idea of the argument required --- however there are problems with this analogous argument, which we will discuss at the time.
First we shall prove the easiest of the implications, the right-directed implication in theorem \ref{thm:CharOfSobSpaces}(ii).
\begin{theorem} \label{thm:dddmesTangGradImplication}
	Let $\bracs{u,\ktgrad_{\dddmes}u}\in\ktgradSob{\ddom}{\dddmes}$.
	Then
	\begin{enumerate}[(i)]
		\item $\bracs{u,\ktgrad_{\dddmes}u}\in\ktgradSob{\ddom}{\ddmes}$, and
		\item $\bracs{u,\ktgrad_{\dddmes}u}\in\ktgradSob{\ddom}{\massMes}$.
	\end{enumerate}
\end{theorem}
\begin{proof}
	Taking an approximating sequence $\phi_n$ for $u$ and given that
	\begin{align*}
		\norm{\cdot}_{\ltwo{\ddom}{\dddmes}}^2 = \norm{\cdot}_{\ltwo{\ddom}{\ddmes}}^2 + \norm{\cdot}_{\ltwo{\ddom}{\massMes}}^2,
	\end{align*}
	we can quickly conclude that $\bracs{u,\ktgrad_{\dddmes}u}\in W_{\ddmes, \mathrm{grad}}^{\kt}$ and $\bracs{u,\ktgrad_{\dddmes}u}\in W_{\massMes, \mathrm{grad}}^{\kt}$, so it just remains to show that $\ktgrad_{\dddmes}u$ coincides with the tangential gradients with respect to $\ddmes$ and $\massMes$.
	However theorem \ref{thm:3DdddmesCharGradZero} handles this, as it ensures that any gradient of zero (with respect to $\ddmes$ or $\massMes$) can be extended by zero to form a gradient of zero with respect to $\dddmes$, to which $\ktgrad_{\dddmes}u$ is orthogonal.
	By means of illustration, for any $g\in\gradZero{\ddom}{\ddmes}$ then $\tilde{g}\in\gradZero{\ddom}{\dddmes}$ where
	\begin{align*}
		\tilde{g} &= 
		\begin{cases} g(x) & x\neq v_j, \ \forall v_j\in\vertSet \\ 0 & x=v_j, \ v_j\in\vertSet, \end{cases}
	\end{align*}
	by theorem \ref{thm:3DdddmesCharGradZero}.
	Therefore,
	\begin{align*}
		0 &= \integral{\ddom}{ \ktgrad_{\dddmes}u\cdot\overline{\tilde{g}} }{\dddmes}
		= \integral{\ddom}{ \ktgrad_{\dddmes}u\cdot\overline{g} }{\ddmes} + \integral{\ddom}{ 0 }{\massMes} \\
		&= \integral{\ddom}{ \ktgrad_{\dddmes}u\cdot\overline{g} }{\ddmes}.
	\end{align*}
	Thus, $\ktgrad_{\dddmes}u$ coincides with $\ktgrad_{\ddmes}u$ on the edges, and $\ktgrad_{\massMes}u$ at the vertices, and we are done.
\end{proof}

Our focus now will be on the proof of theorem \ref{thm:CharOfSobSpaces}(i), and it is at this point we should address the result claimed in \cite{zhikov2002homogenization}.
The primary concern of this study is the homogenisation problem for the equations of elasticity on singular structures.
As such, although the statement of the result in theorem \ref{thm:CharOfSobSpaces}(i) (in the absence of $\qm$ and $\wavenumber$), the study does not provide an explicit proof, instead referring the reader to an analogous result \cite[lemma 6.1]{zhikov2002homogenization} in the aforementioned context of elasticity.
This result (\cite[lemma 6.1]{zhikov2002homogenization}) further depends on the result \cite[proposition 5.5]{zhikov2002homogenization}, which is presented without proof.
When rephrased into our context, this proposition reads as follows:
\begin{prop}[Analogous to Zhikov, 2002] \label{prop:Zhikov5-5}
	Suppose that $u_n\in\gradSob{\ddom}{\ddmes}$ is a sequence such that
	\begin{enumerate}[(i)]
		\item $u_n$ converges weakly in $\pltwo{\ddom}{\ddmes}$ to $u$.
		\item The tangential gradients $\grad_{\ddmes}u_n$ are bounded in $\pltwo{\ddom}{\ddmes}^2$.
	\end{enumerate}
	Then $u\in\gradSob{\ddom}{\ddmes}$.
\end{prop}
Proposition \ref{prop:Zhikov5-5} is familiar when one replaces $\ddmes$ with the usual Lebesgue measure $\lambda_2$: the result in this case being a consequence of the compactness of the embedding of $H^1$ into $L^2$, plus an appeal to the definition of the weak derivative to deduce that the function $u$ also possesses a weak derivative in $L^2$.
When $\ddmes$ is the Lebesgue measure, we can then conclude that $u$ and its gradient are therefore also approximated by smooth functions in the Sobolev norm, using the Meyers-Serrin ``$H=W$`` theorem.
Note however, that for a general measure $\ddmes$ we do \emph{not} define the tangential gradient in the analogous ``weak" (or $W^{m,p}$-sense), we \emph{only} understand $\grad_{\ddmes}u$ through its approximation by smooth functions.
Consequentially, the hypotheses of proposition \ref{prop:Zhikov5-5} are too weak for the conclusion, due to the aforementioned issues --- one can certainly establish that $u_n$ and $\grad_{\ddmes}u_n$ converge \emph{weakly} along a subsequence, however without Meyers-Serrin this does not establish the existence of smooth approximating functions for the weak limits.
A thorough investigation into the matter would need to establish an appropriate ``weak" definition for the $\ddmes$-derivative, determine uniqueness results for the weak derivatives akin to our knowledge of gradients of zero, and from there derive an analogy of the Meyers-Serrin theorem, if possible.
Again we remark that establishing such a weak definition is non trivial, as the motivation for such definitions in the classical (Lebesgue) setting is through imposing that the ``integration by parts" formula holds when testing against smooth functions, and integration by parts does not hold for a general measure $\ddmes$. \tstk{link to the partial IBP theorem if we include it?}
In any event, proposition \ref{prop:Zhikov5-5} is not to be believed without concrete justification, although the result \cite[lemma 6.1]{zhikov2002homogenization} can likely be salvaged using the style of argument that we employ.
Our argument centres around establishing that there is a sequence of smooth functions $\varphi_n$ converging \emph{strongly} to $u$ in $\ltwo{\ddom}{\ddmes}$, with $\ktgrad\varphi_n$ bounded in $\ltwo{\ddom}{\ddmes}^3$ \emph{but also convergent} in $L^1\bracs{\ddom,\md\ddmes}^3$.
This allows us to extract a subsequence converging pointwise almost everywhere, pass to this subsequence and confirm membership of $u\in\ktgradSob{\ddom}{\ddmes}$.
Indeed, the argument employed by \cite[lemma 6.1]{zhikov2002homogenization} already goes some way to establishing such an appropriate sequence --- although one needs to smooth functions to replace $u_n$, and to carefully construct an approximating sequence that does indeed converge in $L^1$.

We begin with the proof of the right-directed implication of theorem \ref{thm:CharOfSobSpaces}(i).
Our approach is as follows; first we show that (i) and (ii) hold by appealing to an approximating sequence and using proposition \ref{prop:3DGradZeroChar}.
For (iii), we also demonstrate that any approximating sequence for $u$ is also Cauchy in the uniform norm on each edge $I_{jk}$, and so must converge by completeness of the uniform norm, and the limit must be $u^{(jk)}$.
This will be enough to deduce that $\phi_n$ converges uniformly on the ``junction region" surrounding each vertex $v_j$, and since $\phi_n$ is chosen to be continuous over all of $\ddom$, we will obtain continuity of $u$ at the vertices.
\begin{theorem} \label{thm:3DTangGradGraph}
	We have that
	\begin{align*}
		u\in\ktgradSob{\ddom}{\ddmes} \quad\Rightarrow\quad
		\begin{cases}
			\mathrm{(i)} \ u\in\ktgradSob{\ddom}{\lambda_{jk}}, & \forall I_{jk}\in\edgeSet, \\
			\mathrm{(ii)} \ \ktgrad_{\ddmes}u = \ktgrad_{\lambda_{jk}}u, & \text{on every } I_{jk}, \\
			\mathrm{(iii)} \ u \text{ is continuous at } v_j, & \forall v_j\in\vertSet.
		\end{cases}
	\end{align*}
\end{theorem}
\begin{proof}
	Suppose $u\in\ktgradSob{\ddom}{\ddmes}$ and let $\phi_n$ be an approximating sequence for $u$.
	Since $\norm{\cdot}_{\ltwo{\ddom}{\lambda_{jk}}} \leq \norm{\cdot}_{\ltwo{\ddom}{\ddmes}}$, we have that 
	\begin{align} \label{eq:3DTangGradProofApproxSequence}
		\phi_n\lconv{\ltwo{\ddom}{\lambda_{jk}}} u, 
		\quad
		\ktgrad\phi_n\lconv{\ltwo{\ddom}{\lambda_{jk}}^3}\ktgrad_{\ddmes}u,
	\end{align}
	and so $u\in\ktgradSob{\ddom}{\lambda_{jk}}$ by definition.
	To show that $\ktgrad_{\ddmes}u = \ktgrad_{\lambda_{jk}}u$ on $I_{jk}$, we must show that $\ktgrad_{\ddmes}u$ is orthogonal to $\gradZero{\ddom}{\lambda_{jk}}$ (and then by uniqueness of tangential gradients the desired equality follows).
	So take any $g\in\gradZero{\ddom}{\lambda_{jk}}$; we have that the function
	\begin{align*}
		\widetilde{g} = \begin{cases} g & x\in I_{jk}, \\ 0 & x\not\in I_{jk} \end{cases}
	\end{align*}
	is an element of $\gradZero{\ddom}{\ddmes}$ by proposition \ref{prop:3DGradZeroChar}.
	Therefore, 
	\begin{align*}
		0 &= \integral{\ddom}{ \ktgrad_{\ddmes}u\cdot\overline{\widetilde{g}} }{\ddmes}
		= \integral{\ddom}{ \ktgrad_{\ddmes}u\cdot\overline{g} }{\lambda_{jk}},
	\end{align*}
	and since $g\in\gradZero{\ddom}{\lambda_{jk}}$ was arbitrary, we have that $\ktgrad_{\ddmes}u$ is orthogonal (in $\ltwo{\ddom}{\lambda_{jk}}$) to $\gradZero{\ddom}{\lambda_{jk}}$.
	As such, we must have that (ii) holds.
	
	Next, consider a vertex $v_j\in\vertSet$ and its connecting edges $I_{jk}$.
	For each such $k$ with $j\con k$, we will denote composition of functions with the map $r_{jk}$ by an overhead tilde for brevity.
	Given \eqref{eq:3DTangGradProofApproxSequence}, corollary \ref{cory:3DTangGradRotated}, (i) and (ii) we can conclude that
	\begin{align*}
		\widetilde{\phi}_n \lconv{\ltwo{\interval{I_{jk}}}{y}} \widetilde{u},
		\quad
		\widetilde{\phi}_n' \lconv{\ltwo{\interval{I_{jk}}}{y}} \widetilde{u}'.
	\end{align*}
	As the embedding
	\begin{align*}
		W^{1,2}\bracs{\interval{I_{jk}},\md y} = \gradSob{\interval{I_{jk}}}{y} \hookrightarrow C^{0,\recip{2}}\bracs{\sqbracs{0,\abs{I_{jk}}}}
	\end{align*}
	is compact, we conclude that $\widetilde{\phi}_n$ is Cauchy in the $C^{0,\recip{2}}$-norm, and hence also Cauchy in the uniform norm,
	\begin{align*}
		\norm{\widetilde{\phi}_n}_{\sup_{jk}} := \sup_{I_{jk}}\abs{\widetilde{\phi}_n}.
	\end{align*}
	As the space of continuous functions is complete with respect to the uniform norm, we conclude that $\widetilde{\phi}_n$ converges (uniformly) on the interval $\interval{I_{jk}}$.
	Furthermore, this limit must be $\widetilde{u}$, which itself must be continuous as it is the uniform limit of continuous functions.
	We can conclude from this that (by ``undoing" the change of variables $r_{jk}$),
	\begin{align*}
		\sup_{I_{jk}}\abs{\phi_n - u} \rightarrow 0 \toInfty{n}.
	\end{align*}
	Therefore, $\phi_n$ also converges uniformly to $u$ on the junction region $\mathcal{J}\bracs{v_j} = \bigcup_{j\con k}I_{jk}$, since one has that
	\begin{align*}
		\sup_{\mathcal{J}\bracs{v_j}}\abs{\phi_n - u} = \sup_{j\con k}\sup_{I_{jk}}\abs{\phi_n - u} \rightarrow 0 \toInfty{n}
	\end{align*}
	due to the uniform convergence on each edge.
	Thus, $u$ is also the uniform limit of continuous functions on $\mathcal{J}\bracs{v_j}$, and thus is continuous on $\mathcal{J}\bracs{v_j}$.
	In particular, it is continuous at the vertex $v_j\in \mathcal{J}\bracs{v_j}$, completing the proof.
\end{proof}

We now move onto the left-directed implication, and our approach is similar to that which we took for gradients.
We will aim to ``lift" functions defined on the edges to the whole graph $\graph$ through extensions by zero, however we no longer have the luxury of our original function being zero almost everywhere.
As a result, we need to consider two cases: when an edge function $u$ has proper distance to the two vertices at the endpoints of the edge, and when this is not the case.
We deal with the former in the lemma which follows.
\begin{lemma}[Extension lemma for edge functions] \label{lem:ExtensionLemmaEdgeFunctions}
	Suppose that $u\in\ktgradSob{\ddom}{\lambda_{jk}}$ with $u=0$ outside $I_{jk}^\eps$ for some $\eps>0$.
	Then $u\in\ktgradSob{\ddom}{\ddmes}$ and $u\in\ktgradSob{\ddom}{\dddmes}$ with
	\begin{align*}
		\ktgrad_{\ddmes}u = 
		\begin{cases} 
			\ktgrad_{\lambda_{jk}}u & x\in I_{jk}, \\
			0 & x\not\in I_{jk}, 
		\end{cases}
		\qquad
		\ktgrad_{\dddmes}u = 
		\begin{cases} 
			\ktgrad_{\lambda_{jk}}u & x\in I_{jk}, \\
			0 & x\not\in I_{jk}, \\
			0 & x\in\vertSet.
		\end{cases}
	\end{align*}
\end{lemma}
\begin{proof}
	Take an approximating sequence $\phi_n$ for $u$ in $\ltwo{\ddom}{\lambda_{jk}}$, and consider the smooth cut-off function $\chi_{jk}^{\eps}$ in \eqref{eq:SmoothChiDef}.
	Construct the sequence $\varphi_n = \chi_{jk}^{\eps}\phi_n$, and note that for each $n\in\naturals$, 
	\begin{align*}
		\varphi_n\bracs{v_j}=0, \qquad
		\ktgrad\varphi_n = \chi_{jk}^{\eps}\ktgrad\phi_n + \phi_n\ograd\chi_{jk}^{\eps}, \qquad
		\ktgrad\varphi_n\bracs{v_j} = 0.
	\end{align*}
	We therefore have that
	\begin{align*}
		\integral{\ddom}{ \abs{\varphi_n - u}^2 }{\massMes} &= \alpha_j\abs{\varphi_n(v_j) - u(v_j)}^2 = 0, \\
		\integral{\ddom}{ \abs{\ktgrad\varphi_n - \ktgrad_{\lambda_{jk}}u}^2 }{\massMes} &= \alpha_j \abs{\ktgrad\varphi_n(v_j) - \ktgrad_{\lambda_{jk}}u(v_j)}^2 = 0.
	\end{align*}
	Furthermore, 
	\begin{align*}
		\integral{\ddom}{ \abs{\varphi_n - u}^2 }{\ddmes} 
		&= \integral{I_{jk}^\eps}{ \abs{\chi_{jk}^\eps\phi_n - u}^2 }{\lambda_{jk}} + \integral{I_{jk}\setminus I_{jk}^\eps}{ \abs{\chi_{jk}^\eps\phi_n - u}^2 }{\lambda_{jk}} \\
		&= \integral{I_{jk}^\eps}{ \abs{\phi_n - u}^2 }{\lambda_{jk}} + \integral{I_{jk}\setminus I_{jk}^\eps}{ \abs{\chi_{jk}^\eps\phi_n}^2 }{\lambda_{jk}} \\
		&\leq \integral{I_{jk}^\eps}{ \abs{\phi_n - u}^2 }{\lambda_{jk}} + \integral{I_{jk}\setminus I_{jk}^\eps}{ \abs{\phi_n}^2 }{\lambda_{jk}} \\
		&= \integral{I_{jk}^\eps}{ \abs{\phi_n - u}^2 }{\lambda_{jk}} + \integral{I_{jk}\setminus I_{jk}^\eps}{ \abs{\phi_n - u}^2 }{\lambda_{jk}} \\
		&= \integral{\ddom}{ \abs{\phi_n - u}^2 }{\lambda_{jk}} \rightarrow 0 \toInfty{n},
	\end{align*}
	and
	\begin{align*}
		\recip{2}\integral{\ddom}{ \abs{\ktgrad\varphi_n - \ktgrad_{\ddmes}u}^2 }{\ddmes}
		&= \recip{2}\integral{I_{jk}}{ \abs{\chi_{jk}^\eps\bracs{\ktgrad\phi_n - \ktgrad_{\lambda_{jk}}u} + \phi_n\ograd\chi_{jk}^\eps}^2 }{\lambda_{jk}} \\
		&\leq \integral{I_{jk}}{ \abs{\ktgrad\phi_n - \ktgrad_{\lambda_{jk}}u}^2 }{\lambda_{jk}}
		+ \integral{I_{jk}}{ \abs{\phi_n\ograd\chi_{jk}^\eps}^2 }{\lambda_{jk}} \\
		&\leq \norm{ \ktgrad\phi_n - \ktgrad_{\lambda_{jk}}u }_{\ltwo{\ddom}{\lambda_{jk}}^2}^2 \\
		&\qquad + \sup\abs{\ograd\chi_{jk}^\eps}\integral{I_{jk}\setminus I_{jk}^\eps}{ \abs{\phi_n}^2 }{\lambda_{jk}} \\
		&\leq \norm{ \ktgrad\phi_n - \ktgrad_{\lambda_{jk}}u }_{\ltwo{\ddom}{\lambda_{jk}}^2}^2 \\
		&\qquad + \sup\abs{\ograd\chi_{jk}^\eps}\integral{I_{jk}\setminus I_{jk}^\eps}{ \abs{\phi_n - u}^2 }{\lambda_{jk}} \\
		&\leq \norm{ \ktgrad\phi_n - \ktgrad_{\lambda_{jk}}u }_{\ltwo{\ddom}{\lambda_{jk}}^2}^2 \\
		&\qquad + \sup\abs{\ograd\chi_{jk}^\eps}\norm{ \phi_n - u }_{\ltwo{\ddom}{\lambda_{jk}}}^2 \\
		&\rightarrow0 \toInfty{n}.
	\end{align*}
	We therefore have that $\varphi_n$ serves as an approximating sequence for $u$ in each of the spaces $\ktgradSob{\ddom}{\ddmes}$ and $\ktgradSob{\ddom}{\dddmes}$.
	Note that the functions $\ktgrad_{\ddmes}u$ and $\ktgrad_{\dddmes}u$ are necessarily the tangential gradients by the characterisations of the respective sets of gradients of zero.
\end{proof}

Lemma \ref{lem:ExtensionLemmaEdgeFunctions} establishes that we can ``lift" edge functions from the Sobolev spaces into Sobolev functions on the whole graph $\graph$, provided there is some proper distance between the support of said function and the vertices.
Our next result considers the complimentary case, when we look to raise a function supported in a region centred on a vertex to a Sobolev function on the whole graph $\graph$.
The major complication that we have to deal with is that we now have to reconcile the approximating sequences on each edge on their approach to the vertex --- whilst continuity of $u$ will ensure that the approximating sequences themselves match up,there is no such assurance for the incoming derivatives.
There is also the compounding issue that without a proper distance to the vertex, we cannot use our usual cut-off functions to ensure that approximating sequences on each edge \emph{remain} supported on that edge when we move from considering $\lambda_{jk}$ to $\ddmes$.
\begin{lemma}[Extension lemma near vertices] \label{lem:ExtensionLemmaVertexFunctions}
	Let $v_j\in\vertSet$ and let $J\bracs{v_j}$ denote the connecting edges to $v_j$, $J\bracs{v_j} = \clbracs{I_{jk} \setVert j\con k}$ and $\mathcal{J}\bracs{v_j}$ the junction region $\mathcal{J}\bracs{v_j}=\bigcup_{J(v_j)}I_{jk}$.
	Suppose that $u\in\ktgradSob{\ddom}{\lambda_{jk}}$ for all $I_{jk}\in J\bracs{v_j}$, and that there exists some $r>0$ such that $u=0$ outside $B_r\bracs{v_j}\cap \mathcal{J}\bracs{v_j}$.
	Suppose further that $r<\min_{J\bracs{v_j}}\clbracs{l_{jk}}$, and that $u$ is continuous at $v_j$, taking the value $u(v_j)$.
	Then $u\in\ktgradSob{\ddom}{\ddmes}$ with
	\begin{align*}
		\ktgrad_{\ddmes}u &= \ktgrad_{\lambda_{jk}}u \qquad\text{on each } I_{jk},
	\end{align*}
	and additionally $u\in\ktgradSob{\ddom}{\dddmes}$ with
	\begin{align*}
		\ktgrad_{\dddmes}u &= 
		\begin{cases}
			\ktgrad_{\lambda_{jk}}u & x\in I_{jk}, \ I_{jk}\in J(v_j), \\
			\begin{pmatrix} 0 \\ 0 \\ \rmi\wavenumber u(v_j) \end{pmatrix} & x=v_j, \\
			0 & \text{ otherwise}.
		\end{cases}
	\end{align*}
\end{lemma}
\begin{proof}
	For each $I_{jk}\in J(v_j)$, take approximating sequences $\phi_l^{jk}$ for $u$ in $\ktgradSob{\ddom}{\lambda_{jk}}$.
	We remark that since $\norm{\phi_l^{jk}-u}_{\ltwo{\ddom}{\lambda_{jk}}}\rightarrow 0$ we can (without loss of generality) take a subsequence $\phi_n^{jk} = \phi_{l_n}^{jk}$ with the property that$\norm{\phi_n^{jk}-u}_{\ltwo{\ddom}{\lambda_{jk}}} \leq \recip{n^2}$ for every $n\in\naturals$, and retaining the usual convergence properties of approximating sequences.
	Furthermore, since $\sqbracs{0,l_{jk}}$ is a bounded domain, the sequences $\phi_n^{jk}, \ktgrad\phi_n^{jk}$ also approximate $u, \ktgrad_{\lambda_{jk}}u$ in $L^1\bracs{\ddom,\md\lambda_{jk}}$ too.
	And finally, we note that since $u\in\ktgradSob{\ddom}{\lambda_{jk}}$ it is almost everywhere equal to an absolutely continuous function, so
	\begin{align*}
		u(x)-u(v_j) 
		&= \int_0^t u_{jk}'(y) \ \md y 
		= \int_0^{l_{jk}} \charFunc{\sqbracs{0,t}}u_{jk}'(y) \ \md y, 
		\qquad x=r_{jk}(t).
	\end{align*}
	By H\"{o}lder's inequality,
	\begin{align*}
		\abs{ u(x)-u(v_j) } 
		\leq \int_0^t \abs{u_{jk}'(y)} \ \md y
		\leq t^{\recip{2}} \norm{u_{jk}'}_{\ltwo{\ddom}{\lambda_{jk}}}.
	\end{align*}
	Let us define $\hat{c} = \max\clbracs{ \norm{u'_{jk}}_{\ltwo{\ddom}{\lambda_{jk}}} \setVert I_{jk} \in J(v_j)}$.
	Since $u$ is continuous at $v_j$ we now have that
	\begin{align*}
		\abs{ u(x)-u(v_j) } \leq c\abs{x-v_j}^{\recip{2}},
	\end{align*}
	whenever $x\in J(v_j)$.
	
	For each $n\in\naturals$, consider the following partition of unity.
	We let $\eta_j^n$ be as in \eqref{eq:SmoothEtaDef}, and for each $I_{jk}\in J(v_j)$ let $\zeta_{jk}^n\in\csmooth{\ddom}$ be such that
	\begin{align*}
		\zeta_{jk}^n + \eta_j^n = 1 \text{ on } I_{jk}, 
		\qquad \zeta_{jk}^n = 0 \text{ when } x\not\in I_{jk}.
	\end{align*}
	Note that since there exists some constant such that $\abs{\grad\eta_j^n}\leq cn$, we also have that $\abs{\grad\zeta_{jk}^n}\leq cn$ on $I_{jk}$ too.
	
	We are now ready to begin the proof.
	Define 
	\begin{align*}	
		\varphi_n = u(v_j)\eta_j^n + \sum_{J(v_j)}\phi^{jk}_n\zeta_{jk}^n\in\csmooth{\ddom}\cap\psmooth{\ddom},
	\end{align*}
	so we have that
	\begin{align*}
		\ktgrad\varphi_n 
		&= u(v_j)\ograd\eta_j^n + \rmi u(v_j)\bracs{\qm_1,\qm_2,\wavenumber}^\top\eta_j^n + \sum_{I_{jk}\in J(v_j)}\zeta_{jk}^n\ktgrad\phi_n^{jk} + \phi_n^{jk}\ograd\zeta_{jk}^n.
	\end{align*}
	We can observe that $\varphi_n\lconv{\ltwo{\ddom}{\ddmes}}u$ from the fact that
	\begin{align*}
		\integral{\ddom}{ \abs{\varphi - u}^2 }{\ddmes}
		&= \sum_{I_{jk}\in J(v_j)}\integral{I_{jk}}{ \abs{u(v_j)\eta_j^n + \phi_n^{jk}\zeta_{jk}^n - u}^2 }{\lambda_{jk}} \\
		&= \sum_{I_{jk}\in J(v_j)}\integral{I_{jk}}{ \abs{\bracs{u(v_j)-u}\eta_j^n + \bracs{\phi_n^{jk}-u}\zeta_{jk}^n}^2 }{\lambda_{jk}} \\
		&\leq 2\sum_{I_{jk}\in J(v_j)} \integral{I_{jk}\cap B_{2/n}(v_j)}{ \abs{u(v_j)-u}^2 }{\lambda_{jk}} + \norm{\phi_n^{jk}-u}_{\ltwo{\ddom}{\lambda_{jk}}}^2 \\
		&\leq 2\sum_{I_{jk}\in J(v_j)} \frac{4\hat{c}^2}{n^2} + \recip{n^4}.
	\end{align*}
	
	We now look to establish convergence of $\ktgrad\varphi_n$ to $\ktgrad_{\ddmes}u$, however we are forced to go about this in a roundabout way.
	First we establish that $\norm{\ktgrad\varphi_n-\ktgrad_{\ddmes}u}_{\ltwo{\ddom}{\ddmes}^3}$ is uniformly bounded in $n$, by first noting that on $I_{jk}$,
	\begin{align*}
		\abs{\ktgrad\varphi_n - \ktgrad_{\ddmes}u}^2
		&= \abs{u(v_j)\ograd\eta_j^n + \rmi u(v_j)\begin{pmatrix} \qm_1 \\ \qm_2 \\ \wavenumber \end{pmatrix} \eta_j^n + \zeta_{jk}^n\ktgrad\phi_n^{jk} + \phi_n^{jk}\ograd\zeta_{jk}^n}^2 \\
		&\leq 4\abs{\bracs{\rmi u(v_j)\begin{pmatrix} \qm_1 \\ \qm_2 \\ \wavenumber \end{pmatrix}-\ktgrad_{\lambda_{jk}}u}\eta_j^n}^2 + 4\abs{\zeta_{jk}^n\bracs{\ktgrad\phi_n^{jk}-\ktgrad_{\lambda_{jk}}u}}^2 \\
		&\qquad + 2\abs{u(v_j)\ograd\eta_j^n + \phi_n^{jk}\ograd\zeta_{jk}^n}^2.
	\end{align*}
	Note that the function $v = \rmi u(v_j)\bracs{\qm_1,\qm_2,\wavenumber}^\top - \ktgrad_{\lambda_{jk}}u\in\ltwo{\ddom}{\ddmes}^3$, and so we have that
	\begin{align*}
		\integral{I_{jk}}{ \abs{\ktgrad\varphi_n - \ktgrad_{\ddmes}u}^2 }{\lambda_{jk}}
		&\leq \frac{4}{n}\norm{v}_{\ltwo{\ddom}{\lambda_{jk}}^3}^2 + 4\norm{\ktgrad\varphi_n 
		- \ktgrad_{\lambda_{jk}}u}_{\ltwo{\ddom}{\lambda_{jk}}^3}^2 \\
		&\qquad + 2\integral{I_{jk}}{ \abs{u(v_j)\ograd\eta_j^n + \phi_n^{jk}\ograd\zeta_{jk}^n}^2 }{\lambda_{jk}}.
	\end{align*}
	The first two terms are clearly bounded uniformly in $n$.
	For the remaining term, we notice that $\ograd\zeta_{jk}^n+\ograd\eta_j^n=0$ on $I_{jk}$, so 
	\begin{align*}
		\integral{I_{jk}}{ \abs{u(v_j)\ograd\eta_j^n + \phi_n^{jk}\ograd\zeta_{jk}^n}^2 }{\lambda_{jk}}
		&= \integral{I_{jk}}{ \abs{ \bracs{u(v_j)-u} + \bracs{u - \phi_n^{jk}} }^2\abs{ \ograd\eta_j^n }^2 }{\lambda_{jk}} \\
		&= \integral{I_{jk}\cap B_{2/n}(v_j)}{ \abs{ \bracs{u(v_j)-u} + \bracs{u - \phi_n^{jk}} }^2\abs{ \ograd\eta_j^n }^2 }{\lambda_{jk}} \\
		&\leq 2c^2 n^2\integral{I_{jk}\cap B_{2/n}(v_j)}{ \abs{u(v_j)-u}^2 }{\lambda_{jk}} \\
		&\qquad + 2c^2n^2\norm{u-\phi_n^{jk}}_{\ltwo{\ddom}{\lambda_{jk}}}^2 \\
		&\leq 2c^2 n^2 \hat{c}^2 \frac{2}{n}\integral{I_{jk}\cap B_{2/n}(v_j)}{}{\lambda_{jk}} + 2c^2 n^{-2} \\
		&= 2c^2 \bracs{ 4\hat{c}^2 + n^{-2} } \leq 2c^2 \bracs{ 4\hat{c}^2 + 1 }
	\end{align*}
	Therefore, using the equality
	\begin{align*}
		\integral{\ddom}{ \abs{\ktgrad\varphi_n - \ktgrad_{\ddmes}u}^2 }{\ddmes} = \sum_{I_{jk}\in J(v_j)} \integral{I_{jk}}{ \abs{\ktgrad\varphi_n - \ktgrad_{\ddmes}u}^2 }{\lambda_{jk}},
	\end{align*}
	we are able to conclude that $\norm{\ktgrad\varphi_n-\ktgrad_{\ddmes}u}_{\ltwo{\ddom}{\ddmes}^3}$ is uniformly bounded in $n$.
	However, through similar manipulations to the above, we are able to deduce that
	\begin{align*}
		\norm{\ktgrad\varphi_n-\ktgrad_{\ddmes}u}_{L^1\bracs{\ddom,\md\ddmes}^3}
		&\leq \frac{2}{n}\norm{v}_{L^1\bracs{\ddom,\md\ddmes}^3}
		+ \norm{\ktgrad\phi_n^{jk} - \ktgrad_{\lambda_{jk}u}}_{L^1\bracs{\ddom,\md\ddmes}^3} \\
		&\qquad + cn\integral{I_{jk}\cap B_{2/n}(v_j)}{ \abs{u(v_j)-u} }{\lambda_{jk}} \\
		&\qquad + cn\integral{I_{jk}\cap B_{2/n}(v_j)}{ \abs{u-\phi_n^{jk}} }{\lambda_{jk}} \\
		&\leq \frac{2}{n}\norm{v}_{L^1\bracs{\ddom,\md\ddmes}^3}
		+ \norm{\ktgrad\phi_n^{jk} - \ktgrad_{\lambda_{jk}u}}_{L^1\bracs{\ddom,\md\ddmes}^3} \\
		&\qquad + \frac{c\hat{c}}{\sqrt{n}}
		+ cn\norm{\charFunc{\sqbracs{0,2/n}}}_{\ltwo{\ddom}{\lambda_{jk}}}\norm{u-\phi_n^{jk}}_{\ltwo{\ddom}{\lambda_{jk}}} \\
		&\leq \frac{2}{n}\norm{v}_{L^1\bracs{\ddom,\md\ddmes}^3}
		+ \norm{\ktgrad\phi_n^{jk} - \ktgrad_{\lambda_{jk}u}}_{L^1\bracs{\ddom,\md\ddmes}^3} \\
		&\qquad + \frac{c\hat{c}}{\sqrt{n}}
		+ \frac{2c}{n} \rightarrow0 \toInfty{n}.
	\end{align*}
	
	We have deduced that $\ktgrad\varphi_n\lconv{L^1\bracs{\ddom,\md\ddmes}^3}\ktgrad_{\ddmes}u$.
	Therefore, there exists a subsequence $\varphi_{n_k}$ such that $\ktgrad\varphi_n\rightarrow\ktgrad_{\ddmes}u$ pointwise $\ddmes$-almost everywhere.
	However, since additionally $\norm{\ktgrad\varphi_n-\ktgrad_{\ddmes}u}_{\ltwo{\ddom}{\ddmes}^3}$ is uniformly bounded, $\ktgrad\varphi_n\in\ltwo{\ddom}{\ddmes}^3$ for all $n\in\naturals$, and $\ktgrad_{\ddmes}u\in\ltwo{\ddom}{\ddmes}^3$ by construction, the Dominated Convergence Theorem implies that
	\begin{align*}
		\norm{\ktgrad\varphi_{n_k}-\ktgrad_{\ddmes}u}_{\ltwo{\ddom}{\ddmes}^3} \rightarrow 0 \toInfty{k}.
	\end{align*}
	That is to say, $\ktgrad\varphi_{n_k}\lconv{\ltwo{\ddom}{\ddmes}^3}\ktgrad_{\ddmes}u$.
	Since $\varphi_{n_k}$ is a subsequence of $\varphi_n$, we also retain the convergence $\varphi_{n_k}\lconv{\ltwo{\ddom}{\ddmes}}u$, which proves that $u\in\ktgradSob{\ddom}{\ddmes}$.
	Again, we note that $\ktgrad_{\ddmes}u$ is necessarily the tangential gradient by proposition \ref{prop:3DGradZeroChar}.
	
	We now turn our attention to proving $u\in\ktgradSob{\ddom}{\dddmes}$, however the hard work has already been done.
	Retain the sequence $\varphi_k := \varphi_{n_k}$, and note that $\varphi_k(v_j) = u(v_j)$ by construction, and that $\ktgrad\varphi(v_j) = \rmi u(v_j)\bracs{\qm_1,\qm_2,\wavenumber}^\top$.
	Next we note that by theorem \ref{thm:3DdddmesCharGradZero}, $w := \rmi u(v_j)\bracs{\qm_1,\qm_2,0}^\top\in\gradZero{\ddom}{\dddmes}$ and so there exists an approximating sequence $\xi_k$ for $w$ in $\ltwo{\ddom}{\dddmes}$.
	The sequence $\varphi_k - \xi_k$ the converges to $u$ in $\ltwo{\ddom}{\ddmes}$ and has $\ktgrad\bracs{\varphi_k - \xi_k}$ converging to $\ktgrad_{\dddmes}u$ in $\ltwo{\ddom}{\ddmes}^3$, which completes the proof of the theorem.
\end{proof}

We are now ready to prove the left-directed implication of theorem \ref{thm:CharOfSobSpaces}.
\begin{theorem} \label{thm:LeftDirect-SobChar}
	The left-directed implication of theorem \ref{thm:CharOfSobSpaces}(i) and (ii) holds.
\end{theorem}
\begin{proof}
	Fix $r>0$ such that $r<\recip{3}\min\clbracs{l_{jk} \setVert I_{jk}\in\edgeSet}$.
	Consider a smooth partition of unity that includes the functions $\eta_j^r$ for each $v_j\in\vertSet$ and $\zeta_{jk}^r$ for each $I_{jk}\in\edgeSet$, where
	\begin{align} \label{eq:LeftDirect-SobChar-PartOfUnity}
		\zeta_{jk}^r + \eta_j^r + \eta_k^r = 1, \text{on } I_{jk}, 
		\qquad
		\zeta_{jk}^r = 0, \text{whenever } x\in\graph\setminus I_{jk}.
	\end{align}
	The functions $u\eta_j^r$ satisfy the hypothesis of lemma \ref{lem:ExtensionLemmaVertexFunctions} for every $v_j\in\vertSet$, whilst $u_{jk}\zeta_{jk}^r$ satisfy those of lemma \ref{lem:ExtensionLemmaEdgeFunctions}, so are all functions in $\ktgradSob{\ddom}{\ddmes}$ and $\ktgradSob{\ddom}{\dddmes}$.
	Given that
	\begin{align*}
		u = \bracs{ \sum_{v_j\in\vertSet} \eta_j^r + \sum_{I_{jk}\in\edgeSet} \zeta_{jk}^r }u,
	\end{align*}
	linearity of $\ktgradSob{\ddom}{\ddmes}$ and $\ktgradSob{\ddom}{\dddmes}$, along with \eqref{eq:LeftDirect-SobChar-PartOfUnity}, completes the proof.
\end{proof}