\section{Reformulation of \eqref{eq:SI-WaveEqn} as a Non-Local Quantum Graph Problem} \label{sec:SI-NonLocalQG}
Both of the methods employed in sections \ref{sec:SI-VarProbMethod} and \ref{ssec:SI-FDMMethod} force us to handle the interaction between the bulk regions and skeleton in some way; either through the global approximation we use (if working from \eqref{eq:SI-VarProb}) or through how we tie the various approximations in the bulk regions and skeleton together (in the approach of section \ref{ssec:SI-FDMMethod}).
The question we ask here is whether we can take this one step further; can we entirely remove the equations in the bulk regions from our formulation, replacing them with a suitable term (or terms) in the equations along the skeleton?
Our objective is to arrive at a quantum graph problem, which are relatively well understood when compared to the measure-theoretic formulation \eqref{eq:SI-WaveEqn} that we begun with.
We also expect to see some kind of reward in dimension or complexity reduction, as a quantum graph is ultimately a set of one-dimensional intervals.

\subsection{Reduction to a Quantum Graph Problem} \label{ssec:SI-ToQG}
In order to investigate how to reduce \eqref{eq:SI-WaveEqn} to a quantum graph problem, we should look at how the behaviour of an eigenfunction in the bulk regions affects the behaviour of said eigenfunction on the skeleton.
We already know that the eigenfunction itself is continuous across the skeleton, so the function values on the boundary of each bulk region coincide with the function values on the skeleton.
Furthermore, we also observe that the normal derivative of the eigenfunction from the adjacent regions affects the behaviour along the skeleton.
So, the question is whether we can express the (traces of the) normal derivatives from the adjacent regions in terms of the values of our function on the skeleton, given that we know \eqref{eq:SI-BulkEqn} is satisfied in each bulk region?
This draws our attention to the Dirichlet-to-Neumann map for the Helmholtz equation on $\ddom_i$: we are asking whether we can determine the Neumann data of a function that satisfies \eqref{eq:SI-BulkEqn}, given its Dirichlet values on the boundary.

For each bulk region $\ddom_i$ and $\omega^2>0$ that is \emph{not} an eigenvalue of the Dirichlet laplacian on $\ddom_i$\footnote{That is, an eigenvalue of Laplace's equation on $\ddom_i$ satisfying homogeneous boundary conditions on $\partial\ddom_i$.}, define the set $D_i$ by
\begin{align*}
	D^i_\omega = \{ \bracs{g,h}\in\ltwo{\partial\ddom_i}{S}\times\ltwo{\partial\ddom_i}{S} \ \vert \
	& \exists v\in\gradgradSob{\ddom_i}{\lambda_2} \text{ s.t. } \\
	&\quad \bracs{\laplacian_\qm + \omega^2}v = 0, \\
	&\quad v\vert_{\partial\ddom_i}=g, \ \left.\bracs{\tgrad v\cdot n}\right\vert_{\partial\ddom_i} = h \}.
	\labelthis\label{eq:SI-DtNMapRegion}
\end{align*}
The Dirichlet to Neumann map $\dtn^i_\omega$ for the operator $\laplacian_{\qm}+\omega^2$ in the bulk region $\ddom_i$ is then the operator $\dtn^i_\omega$ where
\begin{align*}
	\dom\bracs{\dtn^i_\omega} = D^i_\omega, \qquad
	\dtn^i_\omega g = h,
\end{align*}
where $g,h$ are related as in \eqref{eq:SI-DtNMapRegion}.
Notice that it is imperative that $\omega^2$ is not an eigenvalue of the Dirichlet laplacian on $\ddom_i$, as otherwise $\dtn_{\omega}^i$ is ill-defined (the zero function can be mapped to infinitely many other functions).
Now suppose we have a solution $u, \omega^2$ to \eqref{eq:SI-StrongForm}, with $\omega^2$ not being an eigenvalue of the Dirichlet laplacian on any of the bulk regions.
Then for every bulk region $\ddom_i$, $u\in\gradSob{\partial\ddom_i}{S}$ and there exists a $v$ as in \eqref{eq:SI-DtNMapRegion} (that $v$ \emph{being} $u$).
Given continuity of $u$ across the skeleton, we thus have that
\begin{align*}
	\bracs{\tgrad u\cdot n_{jk}}^+ = -\bracs{\dtn^+_\omega u}\vert_{I_{jk}},
	&\quad
	\bracs{\tgrad u\cdot n_{jk}}^- = \bracs{\dtn^-_\omega u}\vert_{I_{jk}},
\end{align*}
where we have used $\pm$ to denote the Dirichlet-to-Neumann maps for the regions $\ddom^{\pm}_{jk}$.
Substituting into \eqref{eq:SI-InclusionEqn} gives us the new equation
\begin{align*}
	- \bracs{\diff{}{y} + \rmi\qm_{jk}}^2u^{(jk)} 
	&= \omega^2 u^{(jk)} - \bracs{ \dtn^+_\omega u + \dtn^-_\omega u },
\end{align*}
on each $I_{jk}$.

Conversely, consider an eigenpair $\omega^2>0, u\in H^2\bracs{\graph}$ of the problem
\begin{subequations} \label{eq:SI-NonLocalQG}
	\begin{align}
		- \bracs{\diff{}{y} + \rmi\qm_{jk}}^2u^{(jk)} 
		&= \omega^2 u^{(jk)} - \bracs{ \dtn^+_\omega u^{(jk)} + \dtn^-_\omega u^{(jk)}},
		&\qquad\text{on } I_{jk}, \label{eq:SI-NonLocalQGEdgeEquation}  \\
		\sum_{j\con k} \bracs{\pdiff{}{n}+\rmi\qm_{jk}} u^{(jk)}(v_j) &= 0,
		&\qquad\text{at every } v_j\in\vertSet, \label{eq:SI-NonLocalQGVertexDeriv} \\
		u \text{ is continuous,} & 
		&\qquad\text{at every } v_j\in\vertSet. \label{eq:SI-NonLocalQGVertexCont}
	\end{align}
\end{subequations}
It can be demonstrated that this eigenpair of \eqref{eq:SI-NonLocalQG} also defines a solution $\omega^2, \tilde{u}$ to \eqref{eq:SI-StrongForm}; take $\tilde{u}=u$ on $\graph$, and in the bulk regions assign $\tilde{u}$ the values of the function $v$ in \eqref{eq:SI-DtNMapRegion} for $g=u$ (which exists since we assume $u$ solves \eqref{eq:SI-NonLocalQG} in the first place).
Therefore, up to possibly the eigenvalues of the Dirichlet laplacian in the bulk regions, \eqref{eq:SI-NonLocalQG} shares the same eigenvalues as \eqref{eq:SI-StrongForm}.

The problem \eqref{eq:SI-NonLocalQG} is inherently non-local --- notice that (for each edge $I_{jk}$) the terms $\dtn^{\pm}_\omega u$ require information about the function $u$ on edges that form the boundary of one of the adjacent region $\ddom_{jk}^{\pm}$, which are not necessarily (directly) connected to $I_{jk}$ itself.
The Dirichlet-to-Neumann map is the tool that allows us to encode this non-local effect that arises due to the dynamics that are occurring in the (now removed) bulk regions, and its appearance in \eqref{eq:SI-NonLocalQGEdgeEquation} can be thought of as the price we have to pay in order to move to the purely quantum graph problem \eqref{eq:SI-NonLocalQG}.
Our previous approaches via the $M$-matrix (section \ref{sec:ScalarDiscussion}) largely depended upon determining an explicit form for the entries of the $M$-matrix, something which is currently unfeasible here as there is no closed form for the Dirichlet-to-Neumann map.
This lack of a closed form also has serious implications when we attempt to solve \eqref{eq:SI-NonLocalQG} numerically, which is the subject of section \ref{ssec:SI-GraphMethod}.

When $\omega^2$ lies on the spectrum of the Dirichlet laplacian on one of the bulk regions $\ddom_i$, we cannot use $\dtn^i_{\omega}$ to reduce \eqref{eq:SI-BulkEqn}-\eqref{eq:SI-VertexCondition} to a quantum graph problem.
Intuitively, with $\omega^2$ on the Dirichlet spectrum there are multiple possible behaviours for $u$ in $\ddom_i$ which cannot be distinguished from one another by examining the Dirichlet boundary values of $u$ and the equation it satisfies in the bulk.
Thus, we also cannot deduce what the Neumann data for $u$ on $\partial\ddom_i$ should be without looking at what $u$ is explicitly doing in the bulk region $\ddom_i$, and hence can never ``remove" $\ddom_i$ from our formulation.
Phrased more precisely, the eigenfunctions of the Dirichlet laplacian on $\ddom_i$ would satisfy \eqref{eq:SI-BulkEqn} in $\ddom_i$, and all would have zero trace onto $\partial\ddom_i$ but different Neumann data.
As a result, $\dtn^i_\omega 0$ would be many-valued and (by linearity) $\dtn^i_\omega g = \dtn^i_\omega\bracs{g+0}$ is also undefined for any $g\in\gradSob{\partial\ddom}{S}$.

Of course, it is worth briefly exploring what we can do if we happen to land on a value $\omega_i^2$ which \emph{is} an eigenvalue of the Dirichlet laplacian in one of the bulk regions $\ddom_i$.
Let $\varphi^{(i)}_n$ be the eigenfunctions corresponding to this eigenvalue (where the index $n$ ranges over the multiplicity of $\omega_i^2$), and write $S_i = \mathrm{span}_n\clbracs{\varphi^{(i)}_n}$.
Clearly, we can add linear combinations of these $\varphi^{(i)}_n$ to a function $u$ that satisfies \eqref{eq:SI-BulkEqn} in $\ddom_i$ and still end up with a function $\tilde{u} := u + \sum_{n}c_n\varphi^{(i)}_n$ that satisfies \eqref{eq:SI-BulkEqn}, $c_n\in\complex$.
Clearly $\tilde{u}\vert_{\partial\ddom_i} = u\vert_{\partial\ddom_i}$, but the traces of the normal derivatives no longer match.
As such, we gain some additional ``freedom" in \eqref{eq:SI-InclusionEqn} when the edge $I_{jk}$ forms part of the boundary of $\ddom_i$.
Therefore, if there exists a $\phi\in S_i$ such that $u$ satisfies
\begin{subequations}
	\begin{align*}
		-\laplacian_{\qm}u &= \omega_i^2 u, &\text{in every } \ddom_j, \\
		-\bracs{\diff{}{y} + \rmi\qm_{jk}}^2u^{(jk)}  
		&= \omega_i^2 u^{(jk)} + \bracs{\bracs{\grad u\cdot n_{jk}}^+ - \bracs{\grad u\cdot n_{jk}}^-} + \mathrm{T}\phi,
		&\text{on } I_{jk}, \\
		\sum_{k} \bracs{\pdiff{}{n}+\rmi\qm_{jk}} u^{(jk)}(v_j) 
		&= 0 
		&\text{at each } v_j\in\vertSet,
	\end{align*}
\end{subequations}
where
\begin{align*}
	\mathrm{T}\phi &=
	\begin{cases}
		0, & \ddom_i\neq\ddom_{jk}^{\pm}, \\
		\bracs{\grad\phi\cdot n_{jk}}^+, & \ddom_i = \ddom_{jk}^+, \\
		-\bracs{\grad\phi\cdot n_{jk}}^-, & \ddom_i = \ddom_{jk}^-, \\
		\bracs{\grad\phi\cdot n_{jk}}^+ -\bracs{\grad\phi\cdot n_{jk}}^-, & \ddom_i = \ddom_{jk}^+ \text{ and } \ddom_i = \ddom_{jk}^-,
	\end{cases}
\end{align*}
then $u, \omega_i^2$ will be a solution to \eqref{eq:SI-StrongForm}.
The $\mathrm{T}\phi$ term encodes this aforementioned freedom that comes from our ability to add eigenfunctions of the Dirichlet laplacian to $u$ in $\ddom_i$, and the knock-on affect on the equations on the skeletons.
We also clearly see why the Dirichlet-to-Neumann map cannot be used in these cases, as both $\tgrad\bracs{u+\phi}\cdot n$ and $\tgrad u\cdot n$ are possible Neumann data for the Dirichlet data $u\vert_{\partial\ddom_i}$.

\subsection{``Spectral Method" on the Inclusions} \label{ssec:SI-GraphMethod}
In this section we discuss some of the considerations and ideas for a numerical method for solving \eqref{eq:SI-NonLocalQG}.
Compared to sections \ref{sec:SI-VarProbMethod} and \ref{ssec:SI-FDMMethod}, the problem \eqref{eq:SI-NonLocalQG} is posed on the one-dimensional domain $\graph$, rather than our original two-dimensional domain $\ddom$, but we have to overcome non-locality in the ODEs themselves.
This non-locality rules out a finite difference approach along the edges of $\graph$, as we have no way of expressing the action of the Dirichlet-to-Neumann map \emph{soley} in terms of nearby function values.
It also rules out our previous approach involving the $M$-matrix since we can no longer make use of the same idea as before and reconstruct the entries of the $M$-matrix just from the knowledge of the function values at the vertices\footnote{There is also the more pressing theoretical question as to whether \eqref{eq:SI-NonLocalQG} admits a boundary triple.}.
Indeed, the handling of the Dirichlet-to-Neumann map term is the main problem with any numerical approach to solving \eqref{eq:SI-NonLocalQG}.

We have to accept this non-locality, and so it does not make sense for us to consider numerical methods that rely on local approximations.
Instead we must use the ideas from spectral methods; decide on a finite-dimensional subspace $V$ in which to approximate the solution to $u$, determine a suitable basis for this space, the expand our approximate solution in terms of this basis and choose the coefficients of the basis expansion to satisfy the problem \eqref{eq:SI-NonLocalQG} in $V$.
A spectral method on the other hand looks to use basis functions that are non-zero over the whole domain.
For the time being, we will simply let $V\subset\htwo{\graph}$ be a finite-dimensional subspace with dimension $M$ and basis functions $\clbracs{\psi_m}_{m=1}^{M}$.
Write the approximate solution $u_V\in V$ to \eqref{eq:SI-NonLocalQG} as
\begin{align*}
	u_V &= \sum_{m=1}^M u_m\psi_m, \qquad u_m\in\complex,
\end{align*}
for basis coefficients $u_m$ to be determined.
We then write the problem \eqref{eq:SI-NonLocalQG} in the (``weak") form
\begin{align*}
	\sum_{v_j\in\vertSet}\sum_{j\conLeft k} 
	\clbracs{ 
	\integral{I_{jk}}{\tgrad_{\lambda_{jk}}u\cdot\overline{\tgrad_{\lambda_{jk}}\phi}}{\lambda_{jk}} 
	+ \integral{I_{jk}}{\overline{\phi}\dtn^+_{\omega}u + \overline{\phi}\dtn^-_{\omega}u}{\lambda_{jk}} 
	}
	&= \omega^2 \sum_{v_j\in\vertSet}\sum_{j\conLeft k}\integral{I_{jk}}{u\overline{\phi}}{\lambda_{jk}},
\end{align*}
which holds for each $\phi$ in a suitable space of test functions.
From here, we replace $u$ with $u_V$, substitute the basis expansion, and choose $\phi=\psi_n$ for each $n\in\clbracs{1,...,M}$ to obtain
\begin{align*}
	0 &= 
	\sum_{m=1}^{M} u_m \bracs{ A_{n,m} + L_{n,m} - \omega^2 B_{n,m} }, \\
	A_{n,m} &= \sum_{v_j\in\vertSet}\sum_{j\conLeft k} \ip{\tgrad_{\lambda_{jk}}\psi_m}{\tgrad_{\lambda_{jk}}\psi_n}_{L^2\bracs{I_{jk}}}, \\
	L_{n,m}\bracs{\omega} &= \sum_{v_j\in\vertSet}\sum_{j\conLeft k} \ip{\dtn^+_{\omega}\psi_m + \dtn^-_{\omega}\psi_m}{\psi_n}_{L^2\bracs{I_{jk}}}, \\
	B_{n,m} &= \sum_{v_j\in\vertSet}\sum_{j\conLeft k} \omega^2\ip{\psi_m}{\psi_n}_{L^2\bracs{I_{jk}}}.
\end{align*}
Letting $M\bracs{\omega^2}$ be the matrix-valued function with entries
\begin{align*}
	\bracs{M\bracs{\omega^2}}_{n,m} &= A_{n,m} + L_{n,m}\bracs{\omega} - \omega^2 B_{n,m},
\end{align*}
our coefficients $u_m$ and approximate eigenvalues $\omega^2$ are then determined by the solution to the generalised eigenvalue problem
\begin{align*}
	M\bracs{\omega^2}U &= 0,
	\qquad
	U = \bracs{u_1, u_2, ... , u_M}^{\top}.
\end{align*}
Insofar we have done nothing different to a standard spectral or finite element method, with the only non-standard terms appearing in our matrix $M\bracs{\omega^2}$ being the $L_{n,m}$ terms coming from the Dirichlet to Neumann map.
These depend in a non-trivial way on the spectral parameter $\omega^2$, and form the major obstacle to the implementation of any numerical scheme.
In order to evaluate $L_{n,m}$, we need to know the action of $\dtn_{\omega}^i$ (for every bulk region $\ddom_i$) on \emph{every} basis function $\psi_m$, or at the least be able to approximate this.
Asking for an analytic expression is a tall order, especially given the wide variety of shapes that the bulk regions $\ddom_i$ can take --- in general, $\ddom_i$ could be any bounded, polygonal domain.
On the numerical approximation side, our obvious option for computing $\dtn^i_\omega\psi_m$ is solving the equation \eqref{eq:SI-BulkEqn} subject to the boundary conditions $u=\psi_m$, and reading off the Neumann data.
However this forces us back to numerically solving each of the problems
\begin{align*}
	-\laplacian_{\qm}v &= \omega^2 v &\text{on } \ddom_i, \\
	v\vert_{\partial\ddom_i} &= \psi_m,
\end{align*}
for every $m=1,...,M$ and bulk region $\ddom_i$, and then reading off the Neumann data of the computed solution.
Furthermore, we will have to perform these computations every time we want to evaluate $M(\omega^2)$ whilst solving the generalised eigenvalue problem.
Ultimately, short of obtaining an analytic expression (or an expression that can be easily approximated numerically) for the action of $\dtn^i_{\omega}$ in terms of $\omega$, there is no simple way to deal with
the inherent influence of \eqref{eq:SI-BulkEqn} on \eqref{eq:SI-NonLocalQGEdgeEquation}.
Possible ideas for alternatives include expressing $L_{n,m}$ in terms of the eigenvalues and eigenfunctions of the $\dtn^i_\omega$ (which are briefly explored in section \ref{sec:SIApp-NonLocalSolve}), or attempting to ``linearise" the Dirichlet-to-Neumann map.